<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carte de Mariage ‚Äî Ahinoam - El√©azar</title>

  <!-- Polices -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Cormorant+Garamond:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#333; --gold:#B08D57; --soft:#8b709a; --soft2:#A882B7; --card-w: 860px;
      --ok:#0b7a34; --err:#a40028; --muted:#6c6272;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:"Cormorant Garamond", serif; color:var(--ink);
      background: radial-gradient(80% 50% at 50% 0%, #ffffff 0%, #faf7fb 60%, #f7f3f9 100%);
      display:flex; min-height:100svh; align-items:center; justify-content:center; padding:24px;
    }
    .card{ width:100%; max-width:var(--card-w); background:#fff; border-radius:18px;
      box-shadow:0 8px 28px rgba(33,12,54,.08); overflow:hidden; position:relative; }
    .inner{ padding:40px 36px 28px; position:relative; z-index:2; }

    .floral-top, .floral-bottom{
      position:absolute; left:0; right:0; display:flex; justify-content:space-between;
      pointer-events:none; z-index:1;
    }
    .floral-top{ top:0; padding:20px 24px;}
    .floral-bottom{ bottom:0; padding:0 24px 8px;}
    .floral-top img, .floral-bottom img{ width:180px; opacity:.95 }

    .monogram{ display:flex; align-items:center; justify-content:center;
      margin:6px auto 12px; width:110px; height:110px; position:relative; }
    .monogram svg{ position:absolute; inset:0 }
    .monogram span{
      font-family:"Cormorant Garamond", serif; font-weight:700; letter-spacing:.02em; font-size:28px;
      background:linear-gradient(180deg, #d7b97d, #a98243); -webkit-background-clip:text; background-clip:text; color:transparent;
    }

    h1.names{
      font-family:"Great Vibes", cursive; font-size:64px; line-height:1.05; text-align:center;
      margin:8px 0 6px; color:#2a2431; text-shadow:0 1px 0 #fff;
    }
    .subline{ text-align:center; font-size:22px; margin:2px 0 12px; color:#6b6472 }
    .oui{ font-family:"Great Vibes", cursive; font-size:54px; text-align:center; margin:6px 0 16px; color:#2d2734; }
    .date-time{ text-align:center; font-size:24px; margin:8px 0 20px; color:#3e3746; }
    .block{ text-align:center; font-size:20px; margin:12px 0; color:#4a4351; }
    .small-note{ text-align:center; font-size:16px; color:#6c6272; margin-top:6px }

    .countdown{
      margin:22px auto 10px; padding:14px 20px; border:1px solid #e9e0ef; border-radius:14px;
      width:min(92%, 560px); display:flex; justify-content:space-between; gap:10px;
      background:linear-gradient(180deg, #fff, #fbf9fc);
    }
    .tile{ flex:1; text-align:center; }
    .tile .num{ font-size:34px; font-weight:700; color:#2b2234 }
    .tile .lbl{ font-size:14px; letter-spacing:.08em; text-transform:uppercase; color:#7a6d85 }

    .music{ margin:10px auto 28px; display:flex; gap:10px; align-items:center; justify-content:center; }
    .btn{ border:none; cursor:pointer; padding:10px 14px; border-radius:999px;
      background:linear-gradient(180deg, #ede3f6, #e5daf0); color:#392b49; font-weight:600;
      box-shadow:0 2px 10px rgba(76,49,108,.12); }

    form{
      margin:18px auto 10px; width:min(92%, 680px); text-align:left;
      padding:18px; border:1px solid #eee5f2; border-radius:16px; background:#fffefe;
    }
    label{ display:block; font-size:16px; margin:10px 0 6px; color:#3b3344 }
    input, select, textarea{
      width:100%; padding:12px 14px; border:1px solid #e3d9ed; border-radius:12px;
      font-family:inherit; font-size:16px; background:#fff; outline-color:var(--soft2);
    }
    textarea{ min-height:110px; resize:vertical }
    .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:12px }
    .primary{
      background:linear-gradient(180deg, #c7a9d7, #9a7ab3); color:white; border:none;
      padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:600;
      box-shadow:0 6px 16px rgba(123,64,168,.2);
    }
    .primary:disabled{ opacity:.6; cursor:not-allowed }

    /* familles gauche/droite */
    .families{
      display:grid; grid-template-columns:1fr 1fr; gap:24px; align-items:start; margin:10px 24px 28px;
    }
    .families .col{
      font-family:"Great Vibes", cursive; font-size:28px; line-height:1.25; color:#2a2431;
      text-shadow:0 1px 2px rgba(0,0,0,.08);
    }
    .families .left{ text-align:left } .families .right{ text-align:right }
    .families p{ margin:6px 0; white-space:normal; word-break:keep-all; }
    h1.names{ margin-top:6px }

    /* status (messages apr√®s envoi) */
    #status { margin-top:8px; }
    .is-ok{ color:var(--ok); }
    .is-err{ color:var(--err); }
    .is-wait{ color:var(--muted); }

    @media (max-width: 640px){
      h1.names{ font-size:44px }
      .oui{ font-size:44px }
      .date-time{ font-size:20px }
      .block{ font-size:18px }
      .floral-top img, .floral-bottom img{ width:140px }
      .families{ grid-template-columns:1fr; gap:8px; margin:6px 12px 18px; }
      .families .col{ text-align:center; font-size:26px; }
    }
  </style>
</head>
<body>

  <main class="card" role="main" aria-labelledby="title">
    <!-- D√©cor floral -->
    <div class="floral-top">
      <img src="floral-top.png" alt="" />
      <img src="floral-top.png" alt="" style="transform:scaleX(-1)" />
    </div>
    <div class="floral-bottom">
      <img src="floral-bottom.png" alt="" />
      <img src="floral-bottom.png" alt="" style="transform:scaleX(-1)" />
    </div>

    <div class="inner">
      <!-- Monogramme -->
      <div class="monogram" aria-hidden="true">
        <svg viewBox="0 0 100 100">
          <polygon points="50,2 91,26 91,74 50,98 9,74 9,26" fill="none" stroke="url(#g)" stroke-width="2.5"/>
          <defs>
            <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0" stop-color="#d7b97d"/><stop offset="1" stop-color="#a98243"/>
            </linearGradient>
          </defs>
        </svg>
        <span>E&amp;A</span>
      </div>

      <!-- Familles -->
      <div class="families">
        <div class="col left">
          <p>M. &amp; Mme Abecassis</p>
        </div>
        <div class="col right">
          <p>Mme Gabison</p>
        </div>
      </div>

      <div class="block">
        Ont la joie de vous faire part du mariage<br>
        de leurs petits-enfants et enfants
      </div>

      <h1 id="title" class="names">
        El√©azar M√©nahem <br><span class="line-break">&amp; Ahinoam</span>
      </h1>

      <p class="subline">se diront</p>
      <div class="oui">‚ÄúOui‚Äù</div>

      <div class="date-time">
        Mardi <strong>4 Novembre 2025</strong><br>
        √† <strong>14h00</strong>
      </div>

      <div class="block">
        √Ä la mairie de Cr√©teil<br>
        1 Pl. Salvador Allende, 94010 Cr√©teil
      </div>

      <p class="small-note">La c√©r√©monie sera suivie d‚Äôun vin d‚Äôhonneur</p>

      <div class="block" style="margin-top:8px">
        Chez la Famille Abecassis<br>
        43 rue du G√©n√©ral Sarrail, 94000 Cr√©teil
      </div>

      <!-- Compte √† rebours -->
      <section aria-label="Compte √† rebours" class="countdown" id="countdown">
        <div class="tile"><div class="num" id="d">‚Äì</div><div class="lbl">Jours</div></div>
        <div class="tile"><div class="num" id="h">‚Äì</div><div class="lbl">Heures</div></div>
        <div class="tile"><div class="num" id="m">‚Äì</div><div class="lbl">Minutes</div></div>
        <div class="tile"><div class="num" id="s">‚Äì</div><div class="lbl">Secondes</div></div>
      </section>

      <!-- Formulaire RSVP -->
      <form id="rsvp" aria-label="Formulaire RSVP">
        <h2 class="subline" style="margin:0 0 8px; font-weight:600;">Formulaire de r√©ponse</h2>

        <label for="name">Nom &amp; Pr√©nom</label>
        <input id="name" name="name" placeholder="Ex: Sarah Cohen" required />

        <hr style="border:none;border-top:1px solid #eee;margin:14px 0;">

        <label for="mairie">Pr√©sence √† la Mairie</label>
        <select id="mairie" name="mairie" required>
          <option value="">Choisir‚Ä¶</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>

        <label for="nbMairie">Nombre de personnes (Mairie)</label>
        <input id="nbMairie" name="nbMairie" type="number" min="0" value="0" required />

        <label for="reception">Pr√©sence √† la Houppa/R√©ception</label>
        <select id="reception" name="reception" required>
          <option value="">Choisir‚Ä¶</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>

        <label for="nbHouppa">Nombre de personnes (Houppa/R√©ception)</label>
        <input id="nbHouppa" name="nbHouppa" type="number" min="0" value="0" required />

        <label for="message">Message pour les mari√©s (optionnel)</label>
        <textarea id="message" name="message" placeholder="Un petit mot pour les mari√©s‚Ä¶"></textarea>

        <div class="actions">
          <button class="primary" id="sendBtn" type="submit">Envoyer</button>
        </div>
        <p id="status" class="small-note" role="status" aria-live="polite"></p>
      </form>
    </div>
  </main>

  <script>
    /* ===== Compte √† rebours ===== */
    const target = new Date("2025-11-04T14:00:00+01:00").getTime();
    const dEl = document.getElementById('d');
    const hEl = document.getElementById('h');
    const mEl = document.getElementById('m');
    const sEl = document.getElementById('s');
    function updateCountdown(){
      const now = Date.now();
      let diff = Math.max(0, target - now);
      const days = Math.floor(diff / (1000*60*60*24)); diff -= days * (1000*60*60*24);
      const hours = Math.floor(diff / (1000*60*60)); diff -= hours * (1000*60*60);
      const minutes = Math.floor(diff / (1000*60)); diff -= minutes * (1000*60);
      const seconds = Math.floor(diff / 1000);
      dEl.textContent = days;
      hEl.textContent = String(hours).padStart(2,'0');
      mEl.textContent = String(minutes).padStart(2,'0');
      sEl.textContent = String(seconds).padStart(2,'0');
    }
    updateCountdown(); setInterval(updateCountdown, 1000);

    /* ===== Musique (s√©curis√© si HTML d√©sactiv√©) ===== */
    const audio = document.getElementById('bgm');
    const playBtn = document.getElementById('playBtn');
    if (audio && playBtn){
      let playing = false;
      playBtn.addEventListener('click', async () => {
        try{
          if(!playing){ await audio.play(); playing = true; playBtn.textContent = "‚è∏Ô∏è Pause"; }
          else { audio.pause(); playing = false; playBtn.textContent = "‚ñ∂Ô∏è Musique"; }
        }catch(e){ alert("Impossible de lancer la musique : " + e.message); }
      });
    }

    /* ===== Formulaire RSVP -> /api/rsvp ===== */
    const form = document.getElementById('rsvp');
    const statusEl = document.getElementById('status');
    const sendBtn = document.getElementById('sendBtn');

    function setStatus(msg, cls){
      statusEl.textContent = msg;
      statusEl.classList.remove('is-ok','is-err','is-wait');
      if (cls) statusEl.classList.add(cls);
    }

    form.addEventListener('submit', async (e) => {
  e.preventDefault();
  sendBtn.disabled = true;
  setStatus("‚è≥ Envoi en cours‚Ä¶", "is-wait");

  let mairie = form.mairie.value;
  let nbMairie = Number(form.nbMairie.value || 0);
  if (mairie === "Non") nbMairie = 0;

  let reception = form.reception.value;
  let nbHouppa = Number(form.nbHouppa.value || 0);
  if (reception === "Non") nbHouppa = 0;

  const payload = {
    name: form.name.value.trim(),
    mairie, nbMairie,
    reception, nbHouppa,
    message: form.message.value
  };

  try{
    const res = await fetch("/api/rsvp", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json().catch(()=> ({}));

    if(res.ok && data.ok){
      setStatus("üéâ Merci ! Votre r√©ponse a bien √©t√© enregistr√©e.", "is-ok");
      form.reset();
    }else{
      const why = data?.detail?.message || data?.detail || data?.error || (`HTTP ${res.status}`);
      setStatus(`‚ö†Ô∏è Oups, votre r√©ponse n‚Äôa pas pu √™tre enregistr√©e. (${why})`, "is-err");
      console.error("RSVP error:", data || res.status);
    }
  }catch(err){
    setStatus(`‚ùå Erreur r√©seau: ${err.message}`, "is-err");
    console.error(err);
  }finally{
    sendBtn.disabled = false;
  }
});

  </script>
</body>
</html>
